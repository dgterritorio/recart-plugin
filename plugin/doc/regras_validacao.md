# Regras de validação

Quando se executa a validação no plugin a função `validation.do_validation` percorre os registos da tabela `validation.rules` (ou `validation.rules_area` no caso de se estar a executar por secções) e executa o código SQL associado. Este código pode estar completamente descrito nos atributos `query` desta tabela ou conter chamadas a funções definidas no schema `validation` (nesse caso as funções correspondentes seguem a nomenclatura `<ruleCode>_validation`, i.e.: `re4_10_validation`).

As regras definidas neste plugin são as seguintes:

| Código      | Descrição                                                                                           | Propósito                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ----------- | --------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `rg_1`      | Dimensão mínima dos polígonos                                                                       | Valida a área mínima dos registos em tabelas com geometria do tipo polígono utilizando a função `st_area` (NdD1: 4 m²; NdD2: 20 m²). Valida o comprimento mínimo (20 cm) de geometrias do tipo linha através da função `st_3dlength`.                                                                                                                                                                                      |
| `rg_2`      | Dupla geometria ponto e polígono                                                                    | Valida que em entidades que podem ser representadas com geometria ponto ou geometria polígono a área mínima calculada pela função `st_area` não é inferior aos seguintes valores (NdD1: 4 m²; NdD2: 20 m²).                                                                                                                                                                                                                |
| `ra_3_1`    | Tolerância de conetividade - Curso de água                                                          | Valida a integridade dos elementos que irão compor a rede correspondente                                                                                                                                                                                                                                                                                                                                                   |
| `ra_3_2`    | Tolerância de conetividade - Segmento de via rodoviária                                             | Valida a integridade dos elementos que irão compor a rede correspondente                                                                                                                                                                                                                                                                                                                                                   |
| `ra_3_3`    | Tolerância de conetividade - Segmento de via ferroviária                                            | Valida a integridade dos elementos que irão compor a rede correspondente                                                                                                                                                                                                                                                                                                                                                   |
| `ra_3_3`    | Tolerância de conetividade - Segmento de via ferroviária                                            | Valida a integridade dos elementos que irão compor a rede correspondente                                                                                                                                                                                                                                                                                                                                                   |
| `rg_4_1`    | Consistência tridimensional (Parte 1 - Altimetria)                                                  | Valida que a distância para cada ponto cotado em relação à curva de nível mais próxima é inferior aos valores limite (NdD1: 2 m; NdD2: 5 m)                                                                                                                                                                                                                                                                                |
| `rg_4_2_1`  | Consistência tridimensional (Hidrografia)                                                           | Utiliza a função `st_3dintersects` de maneira a garantir que os nós hidrográficos são consistentes com os eixos dos cursos de água.                                                                                                                                                                                                                                                                                        |
| `rg_4_2_2`  | Consistência tridimensional (Transportes Rodov.)                                                    | Utiliza a função `st_3dintersects` de maneira a garantir que os nós de transporte rodoviário são consistentes com os segmentos da via rodoviária.                                                                                                                                                                                                                                                                          |
| `rg_4_2_3`  | Consistência tridimensional (Transportes Ferrov.)                                                   | Utiliza a função `st_3dintersects` de maneira a garantir que os nós de transporte ferroviário são consistentes com os segmentos da via ferroviária.                                                                                                                                                                                                                                                                        |
| `rg_4_3_2`  | Consistência tridimensional entre Altimetria e Hidrografia (Nível do solo)                          | Utiliza a função `st_intersects` e `st_3dintersects` de maneira a garantir que todos os eixos de cursos de água ao nível do solo, com delimitação conhecida, e não fictícios, que "cruzam" uma curva de nível respeitam o respetivo valor Z (dentro dos limites estabelecidos) .                                                                                                                                          |
| `rg_4_3_3`  | Consistência tridimensional entre Altimetria e Hidrografia (Outras)                                 | Utiliza a função `st_intersects` e `st_3dintersects` de maneira a garantir que todos os eixos de cursos de água não ao nível do solo, com delimitação conhecida, e não fictícios, que "cruzam" uma curva de nível se encontram a uma distância no valor Z superior aos limites estabelecidos.                                                                                                                              |
| `rg_5`      | Polígonos "fechados artificialmente"                                                                | Utiliza a função `St_Contains` de maneira a garantir que todos os polígonos que extravasam a área de trabalho foram cortados nos limites da mesma.                                                                                                                                                                                                                                                                         |
| `rg_6`      | Utilização da letra maiúscula inicial                                                               | Verifica as regras estabelecidas para a utilização de letras maiúsculas em nomes e siglas. Utiliza a função `validation.validcap_pt`.                                                                                                                                                                                                                                                                                      |
| `rg_7`      | Utilização da letra maiúscula inicial                                                               | Verifica as regras estabelecidas para a utilização de letras maiúsculas e para a proibição de utilizar abreviaturas em nomes. Utiliza a função `validation.validcap_pt`.                                                                                                                                                                                                                                                   |
| `re3_1_1`   | Continuidade das curvas de nível (Parte 1)                                                          | Valida que curvas de nível que não se encontrem "fechadas" intersectam os limites da área de trabalho nas suas extremidades.                                                                                                                                                                                                                                                                                               |
| `re3_1_2`   | Continuidade das curvas de nível (Parte 2)                                                          | Verifica que todos os vértices de uma curva de nível respeitam o mesmo valor para Z.                                                                                                                                                                                                                                                                                                                                       |
| `re3_2`     | Equidistância natural                                                                               | Verifica que as cotas respetivas para cada curva de nível em comparação com as mais próximas respeitam a distância vertical pré-estabelecida.                                                                                                                                                                                                                                                                             |
| `re3_3`     | Pontos cotados                                                                                      | Verifica que é recolhido pelo menos um "Ponto cotado" nas zonas planas onde a distância horizontal entre os objetos "Curva de nível" exceda os seguintes valores (NdD1: 100 m; NdD2: 500 m).                                                                                                                                                                                                                               |
| `re4_1_1`   | Representação de água lêntica (Parte 1)                                                             | Verifica que os registos relativos a água lêntica que estejam identificados como tendo `cota_plena_armazenamento=false` têm o atributo data a fonte de dados preenchido.                                                                                                                                                                                                                                                   |
| `re4_1_2`   | Representação de água lêntica (Parte 2 - geometria)                                                 | Verifica que todos os vértices que representam uma água lêntica respeitam o mesmo valor para Z.                                                                                                                                                                                                                                                                                                                            |
| `re4_2`     | Representação do dique, da comporta e da eclusa                                                     | Valida as seguintes condições: 1. A representação do "Dique" é sempre feita através de uma linha. 2. A representação da "Comporta" é sempre feita através de uma única linha (independentemente da área que ocupa, do número de comportas individuais e do nível de detalhe). 3. A representação da "Eclusa" é sempre feita através de um polígono.                                                                        |
| `re4_3_1`   | Representação da barreira da barragem de betão ou terra e da barreira do açude ou represa (Parte 1) | Verifica que os elementos da tabela `barreira` com valor de barreira descrito como 'betão', 'terra', ou 'açude ou represa', são representados por geometria do tipo linha.                                                                                                                                                                                                                                                 |
| `re4_3_2`   | Representação da barreira da barragem de betão ou terra e da barreira do açude ou represa (Parte 2) | Verifica que os elementos da tabela `barreira` com valor de barreira descrito como 'betão' ou 'terra' têm um registo correspondente na tabela `edificio` com valor forma do edifício preenchida para barragem.                                                                                                                                                                                                             |
| `re4_5_1`   | Representação do eixo do curso de água (Parte 1)                                                    | Valida a existência de um eixo de curso de água correspondente a cada àrea do curso de água representada.                                                                                                                                                                                                                                                                                                                  |
| `re4_5_2`   | Representação do eixo do curso de água (Parte 2 - Vértices)                                         | Valida a monotonia relativa aos vértices dos eixos de curso de água.                                                                                                                                                                                                                                                                                                                                                       |
| `re4_8_1`   | Interrupção do curso de água (topologia)                                                            | Utiliza as funções `ST_intersects` e `ST_Touches` de maneira a verificar que todas as interseções de eixos de curso de água se realizam nas suas extremidades.                                                                                                                                                                                                                                                             |
| `re4_8_2`   | Interrupção do curso de água (atributos)                                                            | Verifica que os eixos dos cursos de água apenas são interrompidos nas seguintes condições: 1. Existe uma interceção com outro curso de água; 2. Existe uma alteração do valor de qualquer um dos atributos que caracteriza o "Curso de água - eixo"; 3. Existe uma variação ("Queda de água" ou "Zona húmida") ou regulação de fluxo ("Barreira").                                                                         |
| `re4_9_1`   | Conexão entre o eixo de curso de água e os nós hidrográficos (Parte 1 - Eixos)                      | Valida que os eixos de um curso de água possuem nós hidrográficos correspondentes nas suas extremidades.                                                                                                                                                                                                                                                                                                                   |
| `re4_9_2`   | Conexão entre o eixo de curso de água e os nós hidrográficos (Parte 2 - Nós)                        | Valida que os nós hidrográficos conectam com pelo menos um eixo de curso de água.                                                                                                                                                                                                                                                                                                                                          |
| `re4_10_1`  | Nós de variação ou regulação de fluxo (Parte 1)                                                     | Verifica as seguintes condições: 1. quando existe uma "Queda de água" ou uma "Zona húmida" é colocado no correspondente "Curso de água - eixo" um "Nó hidrográfico" correspondente à "Variação de fluxo"; 2. quando existe uma "Barreira" é colocado no correspondente "Curso de água - eixo" um "Nó hidrográfico" correspondente à "Regulação de fluxo".                                                                  |
| `re4_10_2`  | Nós de variação ou regulação de fluxo (Parte 2 - Nós)                                               | Verifica as seguintes condições: 1. nós do tipo regulação de fluxo são colocados em conformidade com elementos das tabelas `queda_de_agua` ou `zona_humida`; 2. nós do tipo variação de fluxo são colocados em conformidade com elementos da tabela `barreira`.                                                                                                                                                            |
| `re4_11`    | Hierarquia dos nós hidrográficos                                                                    | Verifica a seguinte condição: Quando um “Curso de água - eixo” interseta outro e, simultaneamente, observa-se uma alteração de atributos, o “Nó hidrográfico” assume o valor “Junção”. Apenas é inserido um nó que assume o valor “Junção” prevalecendo este sobre o valor “Pseudo-nó“.                                                                                                                                    |
| `re5_1_1`   | Caracterização das áreas da infraestrutura de transporte aéreo                                      | Verifica a existência de um registo correspondente na tabela `infra_trans_aereo` para cada área de infraestrutura aérea representada.                                                                                                                                                                                                                                                                                      |
| `re5_1_2`   | Representação de um heliporto                                                                       | Verifica a seguinte condição: Um heliporto é representado pela "Área da infraestrutura de transporte aéreo" que limita a respetiva "Área de pista".                                                                                                                                                                                                                                                                        |
| `re5_2_2`   | Interrupção da via-férrea                                                                           | Verifica que um segmento de via férrea apenas é interrompido segundo as condições pré-estabelecidas.                                                                                                                                                                                                                                                                                                                       |
| `re5_2_3_1` | Conexão entre segmentos e nós da via-férrea (Parte 1)                                               | Valida que os segmentos de via férrea possuem nós de transporte ferroviário correspondentes nas suas extremidades.                                                                                                                                                                                                                                                                                                         |
| `re5_2_3_2` | Conexão entre segmentos e nós da via-férrea (Parte 2)                                               | Valida que os nós de transporte ferroviário conectam com pelo menos um segmento de via férrea.                                                                                                                                                                                                                                                                                                                             |
| `re5_2_4`   | Nós terminais da via-férrea                                                                         | Verifica a seguinte condição: quando um “Segmento da via-férrea” tem o seu fim numa “Infraestrutura de transporte ferroviário” é colocado um “Nó de transporte ferroviário” correspondente ao fim da via e um outro “Nó de transporte ferroviário” correspondente à infraestrutura. Os nós são colocados nas mesmas coordenadas (mesma localização) no “Segmento da via-férrea” em conformidade com a topologia implícita. |
| `re5_2_5`   | Hierarquia dos nós da via-férrea                                                                    | Verifica a seguinte condição: quando um “Segmento da via-férrea” interseta outro e, simultaneamente, observa-se uma alteração de atributos, o “Nó de transporte ferroviário” assume o valor “Junção”. Apenas é inserido um nó que assume o valor “Junção” prevalecendo este sobre o valor “Pseudo-nó“.                                                                                                                     |
| `re5_2_6`   | Hierarquia dos nós da via-férrea                                                                    | Verifica a existência de um registo correspondente na tabela `infra_trans_ferrov` para cada área de infraestrutura ferroviária representada.                                                                                                                                                                                                                                                                               |
| `re5_5_2`   | Interrupção da via rodoviária                                                                       | Verifica que um segmento de via rodoviária apenas é interrompido segundo as condições pré-estabelecidas.                                                                                                                                                                                                                                                                                                                   |
| `re5_5_2`   | Interrupção da via rodoviária                                                                       | Verifica que um segmento de via rodoviária apenas é interrompido segundo as condições pré-estabelecidas.                                                                                                                                                                                                                                                                                                                   |
| `re5_5_3_1` | Conexão entre segmentos e nós da via rodoviária (Parte 1)                                           | Valida que os segmentos de via rodoviária possuem nós de transporte rodoviário correspondentes nas suas extremidades.                                                                                                                                                                                                                                                                                                      |
| `re5_5_3_2` | Conexão entre segmentos e nós da via rodoviária (Parte 2)                                           | Valida que os nós de transporte rodoviário conectam com pelo menos um segmento de via rodoviária.                                                                                                                                                                                                                                                                                                                          |
| `re5_5_4`   | Nós terminais da via rodoviária                                                                     | Valida que quando um segmento de via rodoviária intersecta uma infraestrutura de transporte rodoviário são colocados exatamente dois nós de transporte rodoviário correspondentes ao fim da via e à infraestrutura.                                                                                                                                                                                                        |
| `re5_5_5`   | Hierarquia dos nós da via rodoviária                                                                | Verifica a seguinte condição: quando um “Segmento da via rodoviária” interseta outro e, simultaneamente, observa-se uma alteração de atributos, o “Nó de transporte rodoviário” assume o valor “Junção”. Apenas é inserido um nó que assume o valor “Junção” prevalecendo este sobre o valor  “Pseudo-nó ”.                                                                                                                |
| `re_5_5_7`  | Caracterização das áreas da infraestrutura de transporte rodoviário                                 | Verifica a existência de um registo correspondente na tabela `infra_trans_rodov` para cada área de infraestrutura rodoviária representada.                                                                                                                                                                                                                                                                                 |
| `re5_5_8`   | Representação da infraestrutura de transporte rodoviário                                            | Valida que não existem áreas de transporte rodoviário cuja geometria contenha infraestruturas de transporte rodoviário.                                                                                                                                                                                                                                                                                                    |
| `re5_5_9`   | Nó da infraestrutura rodoviária                                                                     | Verifica que cada "Infraestrutura de transporte rodoviário" tem obrigatoriamente associada um "Nó de transporte rodoviário" do tipo "Infraestrutura".                                                                                                                                                                                                                                                                      |
| `re7_1`     | Representação da área agrícola, florestal ou mato                                                   | Valida que as área agrícola, florestal ou mato são recolhidas e representadas se possuírem uma área igual ou superior a: (NdD1: 2 000 m²; NdD2: 5 000 m²).                                                                                                                                                                                                                                                                 |
| `re7_8`     | Nó da infraestrutura rodoviária                                                                     | Valida que os parque e jardim, e as áreas verdes são recolhidas e representadas se possuírem uma área igual ou superior a: (NdD1: 100 m²; NdD2: 1 000 m²).                                                                                                                                                                                                                                                                 |
| `pq1_1`     | Comissão de objetos                                                                                 | Verifica a existência de geometrias duplicadas. Respeitando as exceções estabelecidas para os nós te transporte rodoviário.                                                                                                                                                                                                                                                                                                |
| `pq2_1_1`   | Conformidade dos dados                                                                              | Valida a existência de valores correspondentes nas tabelas de relação (`lig_valor_tipo_circulacao_seg_via_rodov` e `lig_valor_tipo_equipamento_coletivo_equip_util_coletiva`) para as entidades "Segmento via rodoviária" e "Equipamento utilização coletiva", respetivamente.                                                                                                                                             |
| `pq2_4_1`   | Consistência topológica dos objetos                                                                 | Valida a inexistência de descontinuidades para os segmentos de via rodoviária.                                                                                                                                                                                                                                                                                                                                             |
